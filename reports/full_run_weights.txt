scripts/train_models.sh config/train_weights.yml
Running training pipeline with config: config/train_weights.yml
======================================================================
Load Data
----------------------------------------------------------------------
Directory:
data/raw

Files:
Friday-WorkingHours-Afternoon-DDos.pcap_ISCX.csv
(225,745 rows, 79 columns)

Friday-WorkingHours-Afternoon-PortScan.pcap_ISCX.csv
(286,467 rows, 79 columns)

Friday-WorkingHours-Morning.pcap_ISCX.csv
(191,033 rows, 79 columns)

Monday-WorkingHours.pcap_ISCX.csv
(529,918 rows, 79 columns)

Thursday-WorkingHours-Afternoon-Infilteration.pcap_ISCX.csv
(288,602 rows, 79 columns)

Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv
(170,366 rows, 79 columns)

Tuesday-WorkingHours.pcap_ISCX.csv
(445,909 rows, 79 columns)

Wednesday-workingHours.pcap_ISCX.csv
(692,703 rows, 79 columns)

Cleaned column names.

----------------------------------------------------------------------
Loaded Rows:    2,830,743
Loaded Columns: 79
Memory:         1,922.95 MB

======================================================================
Clean Data
----------------------------------------------------------------------
Dropped 1,358 rows with missing values.
Dropped 1,509 rows with infinite values.

----------------------------------------------------------------------
Rows Before: 2,830,743
Rows After:  2,827,876

======================================================================
Indicate Services
----------------------------------------------------------------------
Ports [20, 21] -> is_ftp
Ports [80, 443] -> is_http
Ports [22] -> is_ssh

======================================================================
Drop Features
----------------------------------------------------------------------
Dropped 13 named columns:
- fwd_header_length.1
- average_packet_size
- avg_fwd_segment_size
- avg_bwd_segment_size
- subflow_fwd_packets
- subflow_fwd_bytes
- subflow_bwd_packets
- subflow_bwd_bytes
- init_win_bytes_forward
- init_win_bytes_backward
- act_data_pkt_fwd
- min_seg_size_forward
- down_up_ratio

Dropped 8 columns with zero variance:
- bwd_psh_flags
- bwd_urg_flags
- fwd_avg_bytes_bulk
- fwd_avg_packets_bulk
- fwd_avg_bulk_rate
- bwd_avg_bytes_bulk
- bwd_avg_packets_bulk
- bwd_avg_bulk_rate

----------------------------------------------------------------------
Columns Before: 81
Columns After:  60

======================================================================
Clean Data
----------------------------------------------------------------------
Dropped 2,925 rows with negative values.

----------------------------------------------------------------------
Rows Before: 2,827,876
Rows After:  2,824,951

======================================================================
Prepare Labels
----------------------------------------------------------------------
Replaced label values:
- Web Attack � Brute Force -> web_attack
- Web Attack � Sql Injection -> web_attack
- Web Attack � XSS -> web_attack

Cleaned label values.

----------------------------------------------------------------------
Label Distribution:
_raw_label                  label           
BENIGN                      benign              2268589
Bot                         bot                    1956
DDoS                        ddos                 128006
DoS GoldenEye               dos_goldeneye         10288
DoS Hulk                    dos_hulk             229965
DoS Slowhttptest            dos_slowhttptest       5499
DoS slowloris               dos_slowloris          5796
FTP-Patator                 ftp_patator            7931
Heartbleed                  heartbleed                7
Infiltration                infiltration             35
PortScan                    portscan             158804
SSH-Patator                 ssh_patator            5895
Web Attack � Brute Force    web_attack             1507
Web Attack � Sql Injection  web_attack               21
Web Attack � XSS            web_attack              652

----------------------------------------------------------------------
Rows Before: 2,824,951
Rows After:  2,824,951

======================================================================
Split Data
----------------------------------------------------------------------
Test Size:    0.2
Random State: 76
Stratify:     True

Dataset Sizes:
Full:     2,824,951 rows
Training: 2,259,960 rows (80.0%)
Test:      564,991 rows (20.0%)

Class Balance Comparison:
----------------------------------------------------------------------
Class                  Full Dataset     Training Set         Test Set
----------------------------------------------------------------------
benign            2,268,589 (80.3%) 1,814,870 (80.3%)  453,719 (80.3%)
bot                   1,956 ( 0.1%)    1,565 ( 0.1%)      391 ( 0.1%)
ddos                128,006 ( 4.5%)  102,405 ( 4.5%)   25,601 ( 4.5%)
dos_goldeneye        10,288 ( 0.4%)    8,230 ( 0.4%)    2,058 ( 0.4%)
dos_hulk            229,965 ( 8.1%)  183,972 ( 8.1%)   45,993 ( 8.1%)
dos_slowhttptest      5,499 ( 0.2%)    4,399 ( 0.2%)    1,100 ( 0.2%)
dos_slowloris         5,796 ( 0.2%)    4,637 ( 0.2%)    1,159 ( 0.2%)
ftp_patator           7,931 ( 0.3%)    6,345 ( 0.3%)    1,586 ( 0.3%)
heartbleed                7 ( 0.0%)        6 ( 0.0%)        1 ( 0.0%)
infiltration             35 ( 0.0%)       28 ( 0.0%)        7 ( 0.0%)
portscan            158,804 ( 5.6%)  127,043 ( 5.6%)   31,761 ( 5.6%)
ssh_patator           5,895 ( 0.2%)    4,716 ( 0.2%)    1,179 ( 0.2%)
web_attack            2,180 ( 0.1%)    1,744 ( 0.1%)      436 ( 0.1%)
----------------------------------------------------------------------
Success: Class distribution differences <0.5%

======================================================================
Save Data Splits
----------------------------------------------------------------------
Directory:
data/processed

Files:
- X_train.parquet
- X_test.parquet
- y_train.parquet
- y_test.parquet

======================================================================
Train Models
----------------------------------------------------------------------
LabelEncoder():
- benign             -> 0
- bot                -> 1
- ddos               -> 2
- dos_goldeneye      -> 3
- dos_hulk           -> 4
- dos_slowhttptest   -> 5
- dos_slowloris      -> 6
- ftp_patator        -> 7
- heartbleed         -> 8
- infiltration       -> 9
- portscan           -> 10
- ssh_patator        -> 11
- web_attack         -> 12

----------------------------------------------------------------------
random_forest
----------------------------------------------------------------------
Weighted Average Scores (CV):
- precision: 0.9958
- recall:    0.9959
- f1_score:  0.9957

Per-Class Scores:
           class  precision  recall  f1_score  support
          benign     0.9965  0.9984    0.9974  1814870
             bot     0.9849  0.3342    0.4990     1565
            ddos     0.9995  0.9985    0.9990   102405
   dos_goldeneye     0.9990  0.9615    0.9799     8230
        dos_hulk     0.9899  0.9768    0.9833   183972
dos_slowhttptest     0.9487  0.9750    0.9617     4399
   dos_slowloris     0.9972  0.9843    0.9907     4637
     ftp_patator     1.0000  0.9973    0.9987     6345
      heartbleed     1.0000  0.3333    0.5000        6
    infiltration     0.0000  0.0000    0.0000       28
        portscan     0.9940  0.9992    0.9966   127043
     ssh_patator     0.9844  0.9779    0.9812     4716
      web_attack     0.9967  0.8567    0.9214     1744
overall_weighted     0.9958  0.9959    0.9957  2259960

----------------------------------------------------------------------
xgboost
----------------------------------------------------------------------
Weighted Average Scores (CV):
- precision: 0.9966
- recall:    0.9966
- f1_score:  0.9965

Per-Class Scores:
           class  precision  recall  f1_score  support
          benign     0.9983  0.9976    0.9979  1814870
             bot     0.9665  0.3866    0.5523     1565
            ddos     0.9995  0.9988    0.9991   102405
   dos_goldeneye     0.9937  0.9923    0.9930     8230
        dos_hulk     0.9826  0.9900    0.9863   183972
dos_slowhttptest     0.9479  0.9886    0.9678     4399
   dos_slowloris     0.9955  0.9933    0.9944     4637
     ftp_patator     0.9995  0.9991    0.9993     6345
      heartbleed     1.0000  0.3333    0.5000        6
    infiltration     1.0000  0.5000    0.6667       28
        portscan     0.9939  0.9996    0.9968   127043
     ssh_patator     0.9835  0.9879    0.9857     4716
      web_attack     0.9761  0.9604    0.9682     1744
overall_weighted     0.9966  0.9966    0.9965  2259960

----------------------------------------------------------------------
Results saved:
models/results_weights.pkl

Pipeline complete.

(nids) EMPHMBA003:nids smitht61$ scripts/evaluate_models.sh --results models/results_weights.pkl --data data/processed/
Running evaluation pipeline with results: models/results_weights.pkl and data: data/processed/
======================================================================
Load Results
----------------------------------------------------------------------
Directory:
models

File:
results_weights.pkl

======================================================================
Load Data Splits
----------------------------------------------------------------------
Directory:
data/processed

Files:
X_train
(2,259,960 rows, 59 columns)

X_test
(564,991 rows, 59 columns)

y_train
(2,259,960 rows, 1 columns)

y_test
(564,991 rows, 1 columns)

y_train, y_test coerced to pd.Series

======================================================================
Evaluate Models
----------------------------------------------------------------------
Models:
- random_forest
- xgboost

----------------------------------------------------------------------
random_forest
----------------------------------------------------------------------
           class  precision  recall  f1_score  support
          benign     0.9999  0.9656    0.9824   453719
             bot     0.0322  0.9872    0.0623      391
            ddos     0.9994  0.9995    0.9994    25601
   dos_goldeneye     0.9405  0.9990    0.9689     2058
        dos_hulk     0.9325  0.9988    0.9645    45993
dos_slowhttptest     0.9405  0.9909    0.9650     1100
   dos_slowloris     0.9965  0.9931    0.9948     1159
     ftp_patator     0.9975  1.0000    0.9987     1586
      heartbleed     1.0000  1.0000    1.0000        1
    infiltration     1.0000  0.5714    0.7273        7
        portscan     0.9936  0.9995    0.9965    31761
     ssh_patator     0.8783  0.9975    0.9341     1179
      web_attack     0.7060  0.9748    0.8189      436
overall_weighted     0.9925  0.9721    0.9816   564991

----------------------------------------------------------------------
xgboost
----------------------------------------------------------------------
           class  precision  recall  f1_score  support
          benign     0.9998  0.9667    0.9830   453719
             bot     0.0323  0.9872    0.0626      391
            ddos     0.9978  0.9998    0.9988    25601
   dos_goldeneye     0.9363  0.9995    0.9669     2058
        dos_hulk     0.9541  0.9964    0.9748    45993
dos_slowhttptest     0.7981  0.9918    0.8845     1100
   dos_slowloris     0.9561  0.9948    0.9751     1159
     ftp_patator     0.9962  1.0000    0.9981     1586
      heartbleed     1.0000  1.0000    1.0000        1
    infiltration     0.5000  0.7143    0.5882        7
        portscan     0.9936  0.9996    0.9966    31761
     ssh_patator     0.8279  1.0000    0.9059     1179
      web_attack     0.4704  0.9839    0.6365      436
overall_weighted     0.9935  0.9729    0.9825   564991

(nids) EMPHMBA003:nids smitht61$ scripts/finalize_model.sh --results models/results_weights.pkl --model random_forest --data data/processed/ --output models/final.skops
Finalizing 'random_forest' in models/results_weights.pkl, using data in: data/processed/
======================================================================
Load Results
----------------------------------------------------------------------
Directory:
models

File:
results_weights.pkl

======================================================================
Load Data Splits
----------------------------------------------------------------------
Directory:
data/processed

Files:
X_train
(2,259,960 rows, 59 columns)

X_test
(564,991 rows, 59 columns)

y_train
(2,259,960 rows, 1 columns)

y_test
(564,991 rows, 1 columns)

y_train, y_test coerced to pd.Series

======================================================================
Finalize Model
----------------------------------------------------------------------
Model:          random_forest
Class:          RandomForestClassifier
Samples:        2,824,951
Features:       59
Classes:        13
Scaling used:   False

Package saved:
models/final.skops
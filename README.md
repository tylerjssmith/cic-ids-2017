# Network Intrusion Detection with CIC-IDS-2017

## Overview
This project builds machine learning models for network intrusion detection. The data consist of network flows generated by the [Canadian Institute of Cybersecurity](https://www.unb.ca/cic) for the CIC-IDS-2017 benchmark dataset (see [data/README.md](data/README.md) for details). The models classify flows as normal/benign or one or more types of attacks.

## Model Performance
We aimed to train a multi-class model with the ability to detect any one of 13 attack types using network flows. **A random forest achieved recall >0.98 on nine attack types and >0.9 on 12 types using test data.** A low recall of 0.57 on infiltration attacks may be explained by the low number of test samples (n=7).

We emphasized recall (probability of classifying a flow that is actually an attack as an attack) over precision (probability that a flow classified as an attack is actually an attack) so that more attacks would be detected. The practical tradeoff is that security analysts will spend additional time on false positives, but this is preferable to missing an attack.

<p align = 'center'>
<img src="reports/performance_metrics.jpg" width='90%' />
</p>

Below is the confusion matrix for the test data with rows normalized by column sums so that the diagonal shows recall by attack type. We see that poorer recall on the small number of infiltration flows was due to incorrect classification of these flows as benign.

<p align = 'center'>
<img src="reports/confusion_matrix.jpg" width='90%' />
</p>

Note that we have combined three types of web attacks, including SQL injection and XSS, given limited samples. Network flows (Layer 4 data) associated with these attack types are challenging to distinguish from benign flows. These attacks are better detected through application data (Layer 7 data).

## Getting Started
### Install the Project

```bash
# Clone repo
git clone https://github.com/tylerjssmith/cic-ids-2017.git

# Enter repo
cd cic-ids-2017

# If necessary, create environment and install requirements.
# > conda create --name cic-ids-2017 python
# > conda activate cic-ids-2017
# > pip install -r requirements.txt
```

### Download Data
The raw data need to be downloaded to `data/raw/`. The training pipeline will process the data and save them to `data/processed`. See [data/README.md](data/README.md) for how to obtain the raw data.

### Train and Test Models
The package trains candidate models following a configuration file (see [config/](config/)). This file specifies a series of processing and training functions found in [src/](src/). The configuration file also specifies candidate models (model classes and hyperparameters). The trained models and cross-validation results are saved together as a .pkl file.

```bash
# Train candidate models
bash scripts/train_models.sh config/train.yml
```

The trained models in the .pkl file are evaluated on test data.

```bash
# Evaluate candidate models on test data
bash scripts/evaluate_models.sh \
    --results models/results.pkl \
    --data data/processed/
```

### Finalize Model
A chosen model from the .pkl file is finalized by retraining it on the full data. The final model is saved as a .skops file for deployment.
```bash
# Finalize model
bash scripts/finalize_model.sh \
    --results models/results.pkl \
    --model random_forest \
    --data data/processed/ \
    --output models/final.skops

```

## Next Steps
While recall was the priority, precision was low on bot and Patator/SSH attacks. The practical consequence is that security analysts will need to spend time reviewing false positives. While this is preferable to not detecting attacks, it is an area for improvement.